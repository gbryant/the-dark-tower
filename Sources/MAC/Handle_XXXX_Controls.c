Copyright 2016 Gregory BryantLicensed under the Apache License, Version 2.0 (the "License");you may not use this file except in compliance with the License.You may obtain a copy of the License at    http://www.apache.org/licenses/LICENSE-2.0Unless required by applicable law or agreed to in writing, softwaredistributed under the License is distributed on an "AS IS" BASIS,WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.See the License for the specific language governing permissions andlimitations under the License./***********************************************************************/#include "ProjectHeaders.h"OSStatus Handle_ASSM_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){switch(id){	case kASSM_GoButton:		Function_kASSM_GoButton();break;	case kASSM_Open:			Function_kASSM_Open();break;	case kASSM_Save:			Function_kASSM_Save();break;	case kASSM_New:				Function_kASSM_New();break;}return noErr;}OSStatus Handle_CFRG_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){switch(id){	case kCFRG_NewSource:			Function_kCFRG_NewSource();break;	case kCFRG_EditSource:			break;	case kCFRG_SelectSource:		Function_kCFRG_SelectSource();break;	case kCFRG_SourceName:			gMainCurrFocus=0;break;	case kCFRG_NewData:				break;	case kCFRG_EditData:			break;	case kCFRG_SelectData:			Function_kCFRG_SelectData();break;	case kCFRG_DataName:			gMainCurrFocus=1;break;	case kCFRG_DataExports:			break;	case kCFRG_DataExportCount:		break;	case kCFRG_NewRelocation:		Function_kCFRG_NewRelocation();break;	case kCFRG_EditRelocation:		Function_kCFRG_EditRelocation();break;	case kCFRG_SelectRelocation:	Function_kCFRG_SelectRelocation();break;	case kCFRG_RelocationName:		gMainCurrFocus=2;break;	case kCFRG_NewResource:			break;	case kCFRG_EditResource:		break;	case kCFRG_SelectResource:		Function_kCFRG_SelectResource();break;	case kCFRG_ResourceName:		gMainCurrFocus=3;break;	case kCFRG_main:				gMainCurrFocus=4;break;	case kCFRG_init:				gMainCurrFocus=5;break;	case kCFRG_term:				gMainCurrFocus=6;break;	case kCFRG_Product:				gMainCurrFocus=7;break;	case kCFRG_Type:				gMainCurrFocus=8;break;	case kCFRG_Creator:				gMainCurrFocus=9;break;	case kCFRG_Comments:			break;}return noErr;}OSStatus Handle_DISS_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){FileReference				parSpec;switch(id){	case kDISS_TargetIcon:Function_kDISS_TargetIcon();break;	case kDISS_GoButton:	{	DeactivateControl(gAppControls.tabs);	parSpec = MyGetFolder("\pSelect Folder To Save Package To");	SelectDisassembleMethod(gDISSFileRef,parSpec);	ActivateControl(gAppControls.tabs);	break;	}}return noErr;}OSStatus Handle_EXPL_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){switch(id){	case kEXPL_GoButton:DeactivateControl(gAppControls.p3GoButton);EditSource(gEXPLFileRef);break;	case kEXPL_TargetIcon:Function_kEXPL_TargetIcon();break;}return noErr;}OSStatus Handle_MACH_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){switch(id){	case kMACH_SelectSource:Function_kMACH_SelectSource();break;	case kMACH_SelectMachInfo:Function_kMACH_SelectMachInfo();break;}return noErr;}OSStatus Handle_PREF_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){Boolean dirty;dirty = true;SetWindowProperty(window,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);switch(id){	case kPREF_UseLabeledBranches:	{	if(gGlobalSettings.labels){gGlobalSettings.labels=0;}	else{gGlobalSettings.labels=1;}	break;	}	case kPREF_ProcedureNames:	{	if(gGlobalSettings.procs){gGlobalSettings.procs=0;}	else{gGlobalSettings.procs=1;}	break;	}	case kPREF_SpeedierBranchSort:	{	if(gGlobalSettings.bfspeed){gGlobalSettings.bfspeed=0;}	else{gGlobalSettings.bfspeed=1;}	break;	}}return noErr;}OSStatus Handle_MAIN_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){switch(id){	case kMAIN_Tabs:	{		switch(part)		{			case kASSM_Tab:			{			ClearKeyboardFocus(gAppWindow);			gCurrentTab=kASSM_Tab;			HideControl(gAppControls.pane2);			HideControl(gAppControls.pane3);			SetWindowDefaultButton(gAppWindow,gAppControls.p1GoButton);			ShowControl(gAppControls.pane1);			if(!gOnX){Draw1Control(gAppControls.tabs);}			if(gASSMProjectKey.keyFileRef){ActivateControl(gAppControls.p1GoButton);}			break;			}			case kDISS_Tab:			{			ClearKeyboardFocus(gAppWindow);			gCurrentTab=kDISS_Tab;			HideControl(gAppControls.pane1);			HideControl(gAppControls.pane3);			SetWindowDefaultButton(gAppWindow,gAppControls.p2GoButton);			ShowControl(gAppControls.pane2);			if(!gOnX){Draw1Control(gAppControls.tabs);}			break;			}			case kEXPL_Tab:			{			ClearKeyboardFocus(gAppWindow);			gCurrentTab=kEXPL_Tab;			HideControl(gAppControls.pane1);			HideControl(gAppControls.pane2);			SetWindowDefaultButton(gAppWindow,gAppControls.p3GoButton);			ShowControl(gAppControls.pane3);			if(!gOnX){Draw1Control(gAppControls.tabs);}			//if(gEXPLFileRef){ActivateControl(gAppControls.p3GoButton);}			break;			}		}	break;	}}return noErr;}OSStatus Handle_SRC_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){FileReference			target;ControlRef				scrollBar;long					scrollVal;long					scrollPos;WindowRef				newWindow;switch(id){	case kSRC_ScrollBar:	{	return eventNotHandledErr;	break;	}	case kSRC_HIView:	{	return eventNotHandledErr;	break;	}	case kSRC_SearchMenu:	{	return eventNotHandledErr;	break;	}	case kSRC_SearchBox:	{	return eventNotHandledErr;	break;	}	case kSRC_CloneWindow:	{	GetWindowProperty(window,kCreatorCode,kFileReference,sizeof(FileReference),0,&target);	GetWindowProperty(window,kCreatorCode,kSrcScrollBar,sizeof(ControlRef),0,&scrollBar);	scrollVal = GetControl32BitValue(scrollBar);		newWindow = EditSource(target);		GetWindowProperty(newWindow,kCreatorCode,kSrcScrollBar,sizeof(ControlRef),0,&scrollBar);		SetControl32BitValue(scrollBar,scrollVal);		scrollVal = GetControl32BitValue(scrollBar);			SrcScrollProcedure(scrollBar, kControlIndicatorPart);		return eventNotHandledErr;	break;	}}return noErr;}OSStatus Handle_RLOC_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){OSErr							err;DataBrowserItemID				ids;LongChain						*curr;CGrafPtr						port;GWorldPtr						offscreenGWorld;Rect							dst,rect,theRect;char	*charBuffer;long	textSize,outSize;long			arg;CFStringRef		cfStr;Boolean			dirty;if(!gSkipThisRun){if(gRelocCellSelected){ClearKeyboardFocus(gRelocEditorWindow);HideControl(gRelocEditCellControl);gSelectedRelocItem=0;gRelocCellSelected=false;}}gSkipThisRun=false;if(gMustClearRelocMessage){SetControlData(gAppControls.rlocMessageText, kControlEditTextPart,kControlStaticTextTextTag,1,"");Draw1Control(gAppControls.rlocMessageText);gMustClearRelocMessage=false;}switch(id){	case kRLOC_DataBrowser:	{	return eventNotHandledErr;	break;	}	case kRLOC_Add:	{	dirty = true;	SetWindowModified(gRelocEditorWindow,true);	SetWindowProperty(gRelocEditorWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);	EnableMenuCommand(0,'save');	EnableMenuCommand(0,'svas');	if(!gRelocationEditorItems){ActivateControl(gAppControls.rlocDelete);}		LongChainAdd(&gRelocationEditorItems,gRelocationEditorItemEnum,1,"\p"/*"\pundef"*/,0);//initial setting the 1 represents the "choose mnemonic..." menu item	ids=gRelocationEditorItemEnum;	gRelocationEditorItemEnum++;		err =  AddDataBrowserItems(gAppControls.rlocBrowser,kDataBrowserNoItem,1,&ids,0);			gJustAddedReloc=true;	if(err){DebugFunction("\pAddDataBrowserItems Error");}	break;	}	case kRLOC_Delete:	{	dirty = true;	SetWindowModified(gRelocEditorWindow,true);	SetWindowProperty(gRelocEditorWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);	EnableMenuCommand(0,'save');	EnableMenuCommand(0,'svas');	if(gRelocationEditorSelected)	{	gRelocationRemovingSelection=true;	curr = LongChainPop(&gRelocationEditorSelected);	while(curr)	{	RemoveDataBrowserItems(gAppControls.rlocBrowser,kDataBrowserNoItem,1,&curr->v,0);  //must fix this direct access//wtf is thi comment about?!!?	err=LongChainRemove(&gRelocationEditorItems,curr->v);	if(err){DebugFunction("\pwhooooops Error");}	curr = LongChainPop(&gRelocationEditorSelected);	}	gRelocationRemovingSelection=false;	}	if(!gRelocationEditorItems){DeactivateControl(gAppControls.rlocDelete);}	break;	}}return noErr;}#define WRITE(X)\count=sizeof(X)-1;\FSWrite(fileRef,&count,X);\totalWritten+=count;#define WRITE_P(X)\count=X[0];\FSWrite(fileRef,&count,X+1);\totalWritten+=count;OSStatus Handle_ASKS_Controls(long	id, ControlPartCode part, WindowRef window,ControlRef control){WindowRef		parentWindow;long			winType;Boolean			dirty,isSaved;WindowActions	action;GetSheetWindowParent(window,&parentWindow);GetWindowProperty(parentWindow,kCreatorCode,kWindowType,sizeof(long),0,&winType);GetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),0,&action);switch(winType){	case kMain:	{		switch(id)		{			case kASKS_DontSave:			{			if(gQuitting)			{HideSheetWindow(window);HideWindow(parentWindow);QuitAppModalLoopForWindow(parentWindow);}			if(action==kOpening)			{			gASSMProjectKey.keyFileRef = MyGetFile("\pSelect The Project To Open");			if(gASSMProjectKey.keyFileRef) 			{			ReadKeyFile(&gASSMProjectKey,gASSMProjectKey.keyFileRef);			if(gASSMProjectKey.relocb)			{ActivateControl(gAppControls.cfrgEditRelocation);gEnableEditRelocation=true;}			//Ïif(gASSMProjectKey.asmb)			//Ï{ActivateControl(gAppControls.cfrgEditSource);gEnableEditSource=true;}			Fill_CFRG(&gASSMProjectKey);			ActivateControl(gAppControls.p1GoButton);			ActivateControl(gAppControls.p1SaveAs);			ActivateControl(gAppControls.p1New);			DeactivateControl(gAppControls.p1Save);			DisableMenuCommand(0,'save');			EnableMenuCommand(0,'svas');			dirty = false;			SetWindowModified(gAppWindow,false);			SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);			HideSheetWindow(window);			}			else			{HideSheetWindow(window);}			action = kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			}			else if(action==kCreating)			{			ClearKey(&gASSMProjectKey);			Fill_CFRG((Key*)0);			DeactivateControl(gAppControls.p1New);			DeactivateControl(gAppControls.p1Save);			DeactivateControl(gAppControls.p1SaveAs);			DisableMenuCommand(0,'save');			DisableMenuCommand(0,'svas');			SetWindowModified(gAppWindow,false);			dirty = false;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);			DeactivateControl(gAppControls.p1GoButton);			action = kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			HideSheetWindow(window);				}			break;			}			case kASKS_Cancel:			{			HideSheetWindow(window);			if(gQuitting)			{gQuitting=false;QuitAppModalLoopForWindow(parentWindow);}			action=kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			break;			}			case kASKS_Save:			{			isSaved = Save_Project();			EnableMenuCommand(0,'svas');			if(!isSaved)			{			action = kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			}			else			{			dirty = false;			SetWindowModified(gAppWindow,false);			SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);			DisableMenuCommand(0,'save');			DeactivateControl(gAppControls.p1Save);			}			HideSheetWindow(window);			if(gQuitting)			{			HideWindow(parentWindow);			QuitAppModalLoopForWindow(parentWindow);			}			if(action==kOpening)			{			gASSMProjectKey.keyFileRef = MyGetFile("\pSelect The Project To Open");			if(gASSMProjectKey.keyFileRef) 			{			ReadKeyFile(&gASSMProjectKey,gASSMProjectKey.keyFileRef);			if(gASSMProjectKey.relocb)			{ActivateControl(gAppControls.cfrgEditRelocation);gEnableEditRelocation=true;}			//Ïif(gASSMProjectKey.asmb)			//Ï{ActivateControl(gAppControls.cfrgEditSource);gEnableEditSource=true;}			Fill_CFRG(&gASSMProjectKey);			ActivateControl(gAppControls.p1GoButton);			ActivateControl(gAppControls.p1SaveAs);			ActivateControl(gAppControls.p1New);			DeactivateControl(gAppControls.p1Save);			DisableMenuCommand(0,'save');			EnableMenuCommand(0,'svas');			dirty = false;			SetWindowModified(gAppWindow,false);			SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);			}			action = kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			}			else if(action==kCreating)			{			ClearKey(&gASSMProjectKey);			Fill_CFRG((Key*)0);			DeactivateControl(gAppControls.p1New);			DeactivateControl(gAppControls.p1Save);			DeactivateControl(gAppControls.p1SaveAs);			DisableMenuCommand(0,'save');			DisableMenuCommand(0,'svas');			SetWindowModified(gAppWindow,false);			dirty = false;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);			DeactivateControl(gAppControls.p1GoButton);			action = kExisting;			SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);			}			break;			}		}	break;	}	case kRelocationEditor:	{		switch(id)		{			case kASKS_DontSave:			{			HideSheetWindow(window);			DisposeWindow(parentWindow);			ActivateControl(gAppControls.cfrgNewRelocation);			if(gEnableEditRelocation)			{ActivateControl(gAppControls.cfrgEditRelocation);}			if(gQuitting)			{QuitAppModalLoopForWindow(parentWindow);}			break;			}			case kASKS_Cancel:			{			HideSheetWindow(window);			if(gQuitting)			{gQuitting=false;QuitAppModalLoopForWindow(parentWindow);}			break;			}			case kASKS_Save:			{			Save_Relocations(parentWindow);			HideSheetWindow(window);			DisposeWindow(parentWindow);			if(gEnableEditRelocation)			{ActivateControl(gAppControls.cfrgEditRelocation);}			ActivateControl(gAppControls.cfrgNewRelocation);			if(gQuitting)			{QuitAppModalLoopForWindow(parentWindow);}			break;			}		}	break;	}	case kSourceEditor:	{		switch(id)		{			case kASKS_DontSave:			{			HideSheetWindow(window);			DisposeWindow(parentWindow);			//ÏActivateControl(gAppControls.cfrgNewSource);			//Ïif(gEnableEditSource)			//Ï{ActivateControl(gAppControls.cfrgEditSource);}			if(gQuitting)			{QuitAppModalLoopForWindow(parentWindow);}			break;			}			case kASKS_Cancel:			{			HideSheetWindow(window);			if(gQuitting)			{gQuitting=false;QuitAppModalLoopForWindow(parentWindow);}			break;			}			case kASKS_Save:			{			//Save_Relocations(parentWindow);			HideSheetWindow(window);			DisposeWindow(parentWindow);			//Ïif(gEnableEditSource)			//Ï{ActivateControl(gAppControls.cfrgEditSource);}			//ÏActivateControl(gAppControls.cfrgNewSource);			if(gQuitting)			{QuitAppModalLoopForWindow(parentWindow);}			break;			}		}	break;	}}return noErr;}Boolean Save_Relocations(WindowRef win){void			*fileRef;long			totalWritten;LongChain		*currInstruction;long			count;FileReference	file;void			*err;Boolean			isSaved=false;GetWindowProperty(win,kCreatorCode,kFileReference,sizeof(FileReference*),0,&file);if(file){WriteRelocsToFile(file);isSaved=true;}else{	file = MyPutFile("\p","\p");	if(file)	{	err=FSpCreate(file,'CWIE','TEXT',smSystemScript);	if(!err)	{	SetWindowProperty(win,kCreatorCode,kFileReference,sizeof(FileReference*),&file);	WriteRelocsToFile(file);	isSaved=true;	}	else	{	DebugFunction("\pfile error");	}	}}return isSaved;}void WriteRelocsToFile(FileReference file){void			*fileRef;long			totalWritten;LongChain		*currInstruction;long			count;currInstruction = gRelocationEditorItems;totalWritten=0;FSpOpenDF(file,fsRdWrPerm,&fileRef);while(currInstruction){	switch(currInstruction->opcode)	{		case kDDAT:		{		WRITE("DDAT\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE(",")		NumToString(currInstruction->args->value[1],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kCODE:		{		WRITE("CODE\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kDATA:		{		WRITE("DATA\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kDESC:		{		WRITE("DESC\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kDSC2:		{		WRITE("DSC2\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kVTBL:		{		WRITE("VTBL\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kSYMR:		{		WRITE("SYMR\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kSYMB:		{		WRITE("SYMB\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kCDIS:		{		WRITE("CDIS\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kDTIS:		{		WRITE("DTIS\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kSECN:		{		WRITE("SECN\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kDELT:		{		WRITE("DELT\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kRPT:		{		WRITE("RPT\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE(",")		NumToString(currInstruction->args->value[1],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kLABS:		{		WRITE("LABS\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kLSYM:		{		WRITE("LSYM\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kLRPT:		{		WRITE("LRPT\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE(",")		NumToString(currInstruction->args->value[1],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}		case kLSEC0:		case kLSEC1:		case kLSEC2:		{		WRITE("LSEC\t")		NumToString(currInstruction->args->value[0],gtempstr);		WRITE_P(gtempstr)		WRITE(",")		NumToString(currInstruction->args->value[1],gtempstr);		WRITE_P(gtempstr)		WRITE("\r")		break;		}	}	currInstruction = currInstruction->next;}SetEOF(fileRef,totalWritten);FSClose(fileRef);}#define	_RETURN					\								\count=1;						\FSWrite(outFRef,&count,"\r");	\totalWritten+=count;#define	_TAB					\								\count=1;						\FSWrite(outFRef,&count,"\t");	\totalWritten+=count;#define _WRITE(X,Y)						\										\count=X;								\FSWrite(outFRef,&count,Y);				\totalWritten+=count;#define _WRITE_STRING(X)				\										\count=sizeof(X)-1;						\FSWrite(outFRef,&count,X);				\totalWritten+=count;#define MEATWADMAX (sizeof("meatwad")-1)Boolean Save_Project(void){long				totalWritten,count,textSize,outSize;void				*outFRef;void				*err;unsigned char		*charBuffer;unsigned long		arg;char				hexBuff[8];CFStringRef			cfStr;long				i;Boolean				isSaved=false;long				dirID;FileReference		pkgDir;FSSpec				cntDir;FSSpec				aFile;void				*aFileRef;Str255				prjName;char				meatWadCounter;unsigned char		theData[]	=	{									'Q','Z','','','','A','','','','',									'','','','Y','O','T','O','D','U','A',									'','','','','','','','','P','G',									'4',' ','1','L','\\','O','Z','_','H','V',									'%','+','.','1','8','$','2','A','','',									'','','\0','W','1','1','/',')','(','7',									'W','C','I','B','J',' ','','','\r','',									'M','&','','','','','','','','N',									'[','3','5',' ','M','5','-','=','$','5',									'D','\\','K','Q','[','X','$','*','O','E',									'C','','','','','W','J','N','','\0',									'','J','','','','','','O','','',									'','N','0','#','%','','B','5','','',									'','','','','','-','','','','I',									'\\','K','Q','Z','','','\0','O','[',']',									'','','','','','E','','','','',									'\r','','','\\','V','F','O','T','O','[',									']','','','','','S','l',']','','',									'','Z','.','#','#','','','','','',									'5','\0','','','\0','','','1','','',									'',']','K','','\0','','J','~',']','',									'','','','','','_','4','?','/','A',									'H','X','','','','','','','I','h',									'X','','\0','','J','4','\'','&','','',									'','','','2','\r','\n','','\0','\0','',									'','','Q','J','\n','','','_','m','Q',									'','','','','','','S','¦','Ä','¿',									'í','£','Ñ','®','À',']','[','','','',									'','','','J','K','N','\0','','','',									'J','K','N','','','','','\0','I'									};//dtproj//pkgDir=MyPutFile("\p","\p");pkgDir=0;if(pkgDir){MyPStrAdd(((FSSpec*)pkgDir)->name,"\p.dtproj",prjName);FSMakeFSSpec(((FSSpec*)pkgDir)->vRefNum,((FSSpec*)pkgDir)->parID,prjName,(FSSpec*)pkgDir);FSpDirCreate(pkgDir,smSystemScript,&dirID);FSMakeFSSpec(0,dirID,"\pContents",&cntDir);FSpDirCreate(&cntDir,smSystemScript,&dirID);FSMakeFSSpec(0,dirID,"\pPkgInfo",&aFile);FSpCreate(&aFile,'CWIE','TEXT',smSystemScript);totalWritten=0;FSpOpenDF(&aFile,fsRdWrPerm,&aFileRef);count = 8;FSWrite(aFileRef,&count,&"PRJ ŒûµŒ");totalWritten+=count;SetEOF(aFileRef,totalWritten);FSClose(aFileRef);//----------meatWadCounter=0;for(i=0;i<sizeof(theData);i++){if(meatWadCounter==MEATWADMAX){meatWadCounter=0;}theData[i]^=(("meatwad")[meatWadCounter]);meatWadCounter++;}FSMakeFSSpec(0,dirID,"\pInfo.plist",&aFile);FSpCreate(&aFile,'\0\0\0\0','\0\0\0\0',smSystemScript);totalWritten=0;FSpOpenDF(&aFile,fsRdWrPerm,&aFileRef);count = sizeof(theData);FSWrite(aFileRef,&count,theData);totalWritten+=count;SetEOF(aFileRef,totalWritten);FSClose(aFileRef);//----------}if(!gASSMProjectKey.keyFileRef){gASSMProjectKey.keyFileRef = MyPutFile("\p","\p");if(gASSMProjectKey.keyFileRef){err=FSpCreate(gASSMProjectKey.keyFileRef,'CWIE','TEXT',smSystemScript);if(err){DebugFunction("\p oops...\rfile error");}}}if(gASSMProjectKey.keyFileRef){FSpOpenDF(gASSMProjectKey.keyFileRef,fsRdWrPerm,&outFRef);totalWritten=0;_WRITE_STRING("# The Dark Tower Project File")_RETURN;_RETURN_WRITE_STRING("@Target")_TAB;_TAB;_TABif(gASSMProjectKey.cfrgb){_WRITE_STRING("\"cfrg\"")_RETURN;_RETURNGetControlDataSize(gAppControls.cfrgSourceName,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgSourceName,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Assembly")_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}GetControlDataSize(gAppControls.cfrgDataName,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgDataName,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Data")_TAB;_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}GetControlDataSize(gAppControls.cfrgRelocationName,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgRelocationName,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Relocation")_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}GetControlDataSize(gAppControls.cfrgResourceName,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgResourceName,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Resource")_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}_WRITE_STRING("@SecOff")_RETURN_WRITE_STRING("{")_RETURN_WRITE_STRING("$")GetControlDataSize(gAppControls.cfrgmain,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgmain,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize>1){if(textSize<9){for(i=textSize;i<9;i++){_WRITE_STRING("0")}}_WRITE(textSize-1,charBuffer+1)DisposePtr((char*)charBuffer);}else{_WRITE_STRING("00000000")}_WRITE_STRING(":main")_RETURN_WRITE_STRING("$")GetControlDataSize(gAppControls.cfrginit,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrginit,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize>1){if(textSize<9){for(i=textSize;i<9;i++){_WRITE_STRING("0")}}_WRITE(textSize-1,charBuffer+1)DisposePtr((char*)charBuffer);}else{_WRITE_STRING("00000000")}_WRITE_STRING(":init")_RETURN_WRITE_STRING("$")GetControlDataSize(gAppControls.cfrgterm,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgterm,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize>1){if(textSize<9){for(i=textSize;i<9;i++){_WRITE_STRING("0")}}_WRITE(textSize-1,charBuffer+1)DisposePtr((char*)charBuffer);}else{_WRITE_STRING("00000000")}_WRITE_STRING(":term")_RETURN_WRITE_STRING("}")_RETURN_RETURNGetControlDataSize(gAppControls.cfrgProduct,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgProduct,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Product")_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}GetControlDataSize(gAppControls.cfrgType,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgType,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Type")_TAB;_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}GetControlDataSize(gAppControls.cfrgCreator,kControlEditTextPart,kControlEditTextTextTag,&textSize);charBuffer = (unsigned char*)NewPtr(textSize);GetControlData(gAppControls.cfrgCreator,kControlEditTextPart,kControlEditTextTextTag,textSize,charBuffer,&outSize);if(textSize){_WRITE_STRING("@Creator")_TAB;_TAB_WRITE_STRING("\"")_WRITE(textSize,charBuffer)_WRITE_STRING("\"")_RETURN;_RETURNDisposePtr((char*)charBuffer);}}else if(gASSMProjectKey.machb){_WRITE_STRING("\"mach\"")}else if(gASSMProjectKey.intelb){_WRITE_STRING("\"intel\"")}SetEOF(outFRef,totalWritten);FSClose(outFRef);isSaved=true;}return isSaved;}void Function_kMACH_SelectSource(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect The Main Source File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.asm_);gASSMProjectKey.asm_=temp;FileRef_GetFileName(gASSMProjectKey.asm_,name);SetControlData(gAppControls.machSourceName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);DrawControls(gAppWindow);}}void Function_kMACH_SelectMachInfo(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect MachInfo File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.machinfo);gASSMProjectKey.machinfo=temp;FileRef_GetFileName(gASSMProjectKey.machinfo,name);SetControlData(gAppControls.machMachInfoName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);DrawControls(gAppWindow);}}void Function_kCFRG_NewSource(void){DeactivateControl(gAppControls.cfrgNewSource);EditSource(0);}void Function_kCFRG_SelectSource(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect The Main Source File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.asm_);gASSMProjectKey.asm_=temp;FileRef_GetFileName(gASSMProjectKey.asm_,name);SetControlData(gAppControls.cfrgSourceName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);DrawControls(gAppWindow);}}void Function_kCFRG_SelectData(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect The Data File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.data);gASSMProjectKey.data=temp;FileRef_GetFileName(gASSMProjectKey.data,name);SetControlData(gAppControls.cfrgDataName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);DrawControls(gAppWindow);}}void Function_kCFRG_NewRelocation(void){DeactivateControl(gAppControls.cfrgNewRelocation);EditRelocations(0);}void Function_kCFRG_EditRelocation(void){DeactivateControl(gAppControls.cfrgEditRelocation);EditRelocations(&gASSMProjectKey);}void Function_kCFRG_SelectRelocation(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect The Relocation File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.reloc);gASSMProjectKey.reloc=temp;FileRef_GetFileName(gASSMProjectKey.reloc,name);SetControlData(gAppControls.cfrgRelocationName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);ActivateControl(gAppControls.cfrgEditRelocation);DrawControls(gAppWindow);}}void Function_kCFRG_SelectResource(void){FileReference			temp;Str255					name;Boolean					dirty;temp = MyGetFile("\pSelect The Resource File");if(temp){SetWindowModified(gAppWindow,true);dirty = true;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);EnableMenuCommand(0,'save');EnableMenuCommand(0,'svas');ActivateControl(gAppControls.p1New);ActivateControl(gAppControls.p1Save);ActivateControl(gAppControls.p1SaveAs);FileRef_Dispose(gASSMProjectKey.rsrc);gASSMProjectKey.rsrc=temp;FileRef_GetFileName(gASSMProjectKey.rsrc,name);SetControlData(gAppControls.cfrgResourceName, kControlEditTextPart,kControlStaticTextTextTag,name[0],name+1);DrawControls(gAppWindow);}}void Function_kASSM_GoButton(void){DeactivateControl(gAppControls.tabs);SelectAssembleMethod(&gASSMProjectKey);ActivateControl(gAppControls.tabs);}void Function_kASSM_Open(void){long						size;IconRef						iconRef;short						label;OSErr						err;Rect						rect;ControlButtonContentInfo	cntlBtnCntntInfo;PicHandle					theIconPict;long						stringSize;long						i,j;char						*newString,*string;long						tabCount;GrafPtr						port;Str255						name;FileReference				keyRef;Boolean						dirty;WindowRef					saveWin;Boolean						isSaved=false;WindowActions				action;GetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),0,&dirty);if(dirty){action = kOpening;SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);GetWindowProperty(gAppWindow,kCreatorCode,kSaveSheet,sizeof(WindowRef),0,&saveWin);ShowSheetWindow(saveWin,gAppWindow);}else{gASSMProjectKey.keyFileRef = MyGetFile("\pSelect The Project To Open");if(gASSMProjectKey.keyFileRef) {ReadKeyFile(&gASSMProjectKey,gASSMProjectKey.keyFileRef);if(gASSMProjectKey.relocb){ActivateControl(gAppControls.cfrgEditRelocation);gEnableEditRelocation=true;}//Ïif(gASSMProjectKey.asmb)//Ï{ActivateControl(gAppControls.cfrgEditSource);gEnableEditSource=true;}Fill_CFRG(&gASSMProjectKey);ActivateControl(gAppControls.p1GoButton);ActivateControl(gAppControls.p1SaveAs);ActivateControl(gAppControls.p1New);DeactivateControl(gAppControls.p1Save);DisableMenuCommand(0,'save');EnableMenuCommand(0,'svas');}action = kExisting;SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);}}void Function_kASSM_Save(void){long						size;IconRef						iconRef;short						label;OSErr						err;Rect						rect;ControlButtonContentInfo	cntlBtnCntntInfo;PicHandle					theIconPict;long						stringSize;long						i,j;char						*newString,*string;long						tabCount;GrafPtr						port;Str255						name;FileReference				keyRef;Boolean						dirty;WindowRef					saveWin;Boolean						isSaved;WindowActions				action;isSaved = Save_Project();if(isSaved){dirty = false;SetWindowModified(gAppWindow,false);SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);DisableMenuCommand(0,'save');DeactivateControl(gAppControls.p1Save);}}void Function_kASSM_New(void){long						size;IconRef						iconRef;short						label;OSErr						err;Rect						rect;ControlButtonContentInfo	cntlBtnCntntInfo;PicHandle					theIconPict;long						stringSize;long						i,j;char						*newString,*string;long						tabCount;GrafPtr						port;Str255						name;FileReference				keyRef;Boolean						dirty;WindowRef					saveWin;Boolean						isSaved=false;WindowActions				action;GetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),0,&dirty);if(dirty){action = kCreating;SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);GetWindowProperty(gAppWindow,kCreatorCode,kSaveSheet,sizeof(WindowRef),0,&saveWin);ShowSheetWindow(saveWin,gAppWindow);}else{ClearKey(&gASSMProjectKey);Fill_CFRG((Key*)0);DeactivateControl(gAppControls.p1New);DeactivateControl(gAppControls.p1Save);DeactivateControl(gAppControls.p1SaveAs);DisableMenuCommand(0,'save');DisableMenuCommand(0,'svas');SetWindowModified(gAppWindow,false);dirty = false;SetWindowProperty(gAppWindow,kCreatorCode,kWindowDirty,sizeof(Boolean),&dirty);DeactivateControl(gAppControls.p1GoButton);action = kExisting;SetWindowProperty(gAppWindow,kCreatorCode,kWindowAction,sizeof(WindowActions),&action);}}void Function_kDISS_TargetIcon(void){long						size;IconRef						iconRef;short						label;OSErr						err;Rect						rect;ControlButtonContentInfo	cntlBtnCntntInfo;PicHandle					theIconPict;long						stringSize;long						i,j;char						*newString,*string;long						tabCount;GrafPtr						port;FileReference				tempFR;tempFR = gDISSFileRef;gDISSFileRef = MyGetFile("\pSelect The File To Disassemble");if(gDISSFileRef){GetPort(&port);SetPortWindowPort(gAppWindow);err = GetIconRefFromFile((FSSpec*)gDISSFileRef,&iconRef,&label);if(err){DebugFunction("\pError Obtaining IconRef");}SetRect(&rect,0,0,48,48);theIconPict = OpenPicture(&rect);PlotIconRef(&rect,0,0,0,iconRef);ReleaseIconRef(iconRef);ClosePicture();cntlBtnCntntInfo.contentType	= kControlContentPictHandle;cntlBtnCntntInfo.u.picture		= theIconPict;SetBevelButtonContentInfo(gAppControls.p2TargetIcon,&cntlBtnCntntInfo);if(!gOnX){i=(StringWidth(((FSSpec*)gDISSFileRef)->name)/2);stringSize = ((FSSpec*)gDISSFileRef)->name[0];//tabCount = ((476/2)-(StringWidth(((FSSpec*)gDISSFileRef)->name)/2))/CharWidth('\t');tabCount = ((476/2)-(StringWidth(((FSSpec*)gDISSFileRef)->name)/2))/3;newString = NewPtr(stringSize+tabCount);for(i=0;i<tabCount;i++){newString[i]='\t';}for(j=1;j<=stringSize;i++,j++){newString[i]=((FSSpec*)gDISSFileRef)->name[j];}stringSize+=tabCount;SetControlData(gAppControls.p2TargetName,kControlEditTextPart,kControlStaticTextTextTag,stringSize,newString);DisposePtr(newString);}else{SetControlData(gAppControls.p2TargetName,kControlEditTextPart,kControlStaticTextTextTag,((FSSpec*)gDISSFileRef)->name[0],((FSSpec*)gDISSFileRef)->name+1);}ShowControl(gAppControls.p2TargetName);Draw1Control(gAppControls.p2TargetIcon);SetPort(port);ActivateControl(gAppControls.p2GoButton);}else{gDISSFileRef = tempFR;}}void Function_kEXPL_TargetIcon(void){long						size;IconRef						iconRef;short						label;OSErr						err;Rect						rect;ControlButtonContentInfo	cntlBtnCntntInfo;PicHandle					theIconPict;long						stringSize;long						i,j;char						*newString,*string;long						tabCount;GrafPtr						port;ControlRef					control;Key							theKey;Rect						winRect;WindowRef					iWindow;FileReference				tempFR;tempFR = gEXPLFileRef;gEXPLFileRef = MyGetFile("\pSelect The File To Explore");if(gEXPLFileRef){GetPort(&port);SetPortWindowPort(gAppWindow);err = GetIconRefFromFile((FSSpec*)gEXPLFileRef,&iconRef,&label);if(err){DebugFunction("\pError Obtaining IconRef");}SetRect(&rect,0,0,48,48);theIconPict = OpenPicture(&rect);PlotIconRef(&rect,0,0,0,iconRef);ReleaseIconRef(iconRef);ClosePicture();cntlBtnCntntInfo.contentType	= kControlContentPictHandle;cntlBtnCntntInfo.u.picture		= theIconPict;SetBevelButtonContentInfo(gAppControls.p3TargetIcon,&cntlBtnCntntInfo);if(!gOnX){i=(StringWidth(((FSSpec*)gEXPLFileRef)->name)/2);stringSize = ((FSSpec*)gEXPLFileRef)->name[0];//tabCount = ((476/2)-(StringWidth(((FSSpec*)gDISSFileRef)->name)/2))/CharWidth('\t');tabCount = ((476/2)-(StringWidth(((FSSpec*)gEXPLFileRef)->name)/2))/3;newString = NewPtr(stringSize+tabCount);for(i=0;i<tabCount;i++){newString[i]='\t';}for(j=1;j<=stringSize;i++,j++){newString[i]=((FSSpec*)gEXPLFileRef)->name[j];}stringSize+=tabCount;SetControlData(gAppControls.p3TargetName,kControlEditTextPart,kControlStaticTextTextTag,stringSize,newString);DisposePtr(newString);}else{SetControlData(gAppControls.p3TargetName,kControlEditTextPart,kControlStaticTextTextTag,((FSSpec*)gEXPLFileRef)->name[0],((FSSpec*)gEXPLFileRef)->name+1);}ShowControl(gAppControls.p3TargetName);Draw1Control(gAppControls.p3TargetIcon);SetPort(port);ActivateControl(gAppControls.p3GoButton);}else{gEXPLFileRef = tempFR;}}